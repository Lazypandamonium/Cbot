const Canvas = require("canvas")
const Discord = require("discord.js")
const background = "data:image/jpeg;base64,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"

const dim = {
    height: 675,
    width: 1200,
    margin: 50
}

const av = {
    size: 256,
    x: 480,
    y: 170
}

const generateImage = async (member) => {
    let username = member.user.username
    let discrim = member.user.discriminator
    let avatarURL = member.user.displayAvatarURL({format: "png", dynamic: false, size: av.size})

    const canvas = Canvas.createCanvas(dim.width, dim.height)
    const ctx = canvas.getContext("2d")

    // draw in the background
    const backimg = await Canvas.loadImage(background)
    ctx.drawImage(backimg, 0, 0)

    // draw black tinted box
    ctx.fillStyle = "rgba(0,0,0,0.8)"
    ctx.fillRect(dim.margin, dim.margin, dim.width - 2 * dim.margin, dim.height - 2 * dim.margin)

    const avimg = await Canvas.loadImage(avatarURL)
    ctx.save()
    
    ctx.beginPath()
    ctx.arc(av.x + av.size / 2, av.y + av.size / 2, av.size / 2, 0, Math.PI * 2, true)
    ctx.closePath()
    ctx.clip()

    ctx.drawImage(avimg, av.x, av.y)
    ctx.restore()

    // write in text
    ctx.fillStyle = "white"
    ctx.textAlign = "center"

    // draw in Welcome
    ctx.font = "50px Sans"
    ctx.fillText("Welcome", dim.width/2, dim.margin + 70)

    // draw in the username
    ctx.font = "60px Sans"
    ctx.fillText(username + discrim, dim.width/2, dim.height - dim.margin - 125)

    // draw in to the server
    ctx.font = "40px Sans"
    ctx.fillText("to the server", dim.width / 2, dim.height - dim.margin - 50)

    const attachment = new Discord.MessageAttachment(canvas.toBuffer(), "welcome.png")
    return attachment
}

module.exports = generateImage